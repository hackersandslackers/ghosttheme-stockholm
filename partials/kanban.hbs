<div class="kanban">
  <div class="column" id="backlog">
    <h2>Backlog</h2>
    <div class="cards">
    </div>
  </div>
  <div class="column" id="todo">
    <h2>To Do</h2>
    <div class="cards"></div>
  </div>
  <div class="column" id="progress">
    <h2>In Progess</h2>
    <div class="cards"></div>
  </div>
  <div class="column" id="done">
    <h2>Done</h2>
    <div class="cards"></div>
  </div>
</div>

<script src="https://s3.amazonaws.com/stitch-sdks/js/bundles/4.0.0/stitch.js"></script>
<script>

const {
  Stitch,
  RemoteMongoClient,
  UserPasswordCredential
} = stitch;

const stitchClient = Stitch.initializeDefaultAppClient("hackerjira-bzmfe");

login(new stitch.AnonymousCredential()).then(() => {
  // Initialize a MongoDB Service Client
  const mongodb = stitchClient.getServiceClient(
    RemoteMongoClient.factory,
    "mongodb-atlas"
  );
  client.callFunction("populateCards", ["Backlog"])
}).then(displaycards);

  // Get a hook to the card collection
  const card = mongodb.db("jira").collection("hackersandslackers");

  async function login() {
    await stitchClient.auth.loginWithCredential(new stitch.AnonymousCredential())
  }


// Renders the the card' information in the table
function displaycards(card) {
  const cardTableBody = document.getElementById("backlog");
  //const numResultsEl = document.getElementById("num-results");
  const tableRows = card.map(card => {
    return `
    <div class="card">
      <h5>${card.summary}</h5>
      <p>${card.document}</p>
      <div style="background-color:${card.issuetype_color};" class="issuetype ${card.issuetype}"><img src="${card.issuetype_url}"></div>
      <div class="info">
      <div class="left">
      <div class="avatar"><img src="https://www.gravatar.com/avatar/9eb3868db428fb602e03b3059608199b?s=250&d=mm&r=x"></div>
      <div class="priority ${card.priority}"><i class="fas fa-arrow-up"></i></div>
      </div>
      <div class="epic ${card.epic_name}"><i class="fas fa-bolt" style=color:${card.epic_color};"></i> <span>${card.epic_name}</span></div>
      </div>
    `;
  });
  cardTableBody.innerHTML = tableRows.join("");
  numResultsEl.innerHTML = card.length;
}
</script>
